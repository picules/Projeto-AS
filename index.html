<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, query, orderBy, onSnapshot }
    from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }

  const firebaseConfig = {
    apiKey: "AIzaSyCfHDdYAW8DkZ-XELvUWhUo3ln5rAu-1h8",
    authDomain: "adrjb-99601.firebaseapp.com",
    projectId: "adrjb-99601",
    storageBucket: "adrjb-99601.firebasestorage.app",
    messagingSenderId: "688129341856",
    appId: "1:688129341856:web:c0a378171329e52c038cc5",
    measurementId: "G-2BXZJ9LETC"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const senhas = { Karol: "14", Rodrigo: "@4", Gabriela: "66", Vagner: "admin" };
  let devedores = [], usuarioAtual = "";

  let deferredPrompt;

  // Captura o evento de instalação do PWA
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;

    // Força a instalação logo após o carregamento
    setTimeout(async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
      }
    }, 2000); // espera 2 segundos antes de mostrar
  });

  // Botão de baixar (agora visível para todos)
  const btnDiv = document.getElementById("download-app-btn");
  btnDiv.style.display = "block";
  btnDiv.querySelector("button").addEventListener("click", async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
    } else {
      alert("Se não aparecer, use o menu do navegador e escolha 'Adicionar à tela inicial'.");
    }
  });

  function pedirPermissaoNotificacao() {
    if (usuarioAtual === "Vagner" && Notification.permission !== "granted") {
      Notification.requestPermission().then(perm => {
        if (perm === "granted") new Notification("Notificações ativadas para o ADM!");
      });
    }
  }

  // resto do código igual...
</script>
